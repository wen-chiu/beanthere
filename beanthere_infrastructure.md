# BeanThere æ—…éŠåˆ†å¸³ç³»çµ± - å®Œæ•´åŸºç¤æ¶æ§‹è¨­è¨ˆ

## ä¸€ã€ç³»çµ±æ¶æ§‹æ¦‚è¦½

### æ¶æ§‹åœ–
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        User Layer                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LINE Bot Client    â”‚    LIFF Web App (Vue.js)              â”‚
â”‚  (Flex Messages)    â”‚    (Progressive Web App)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Gateway / Load Balancer              â”‚
â”‚                        (Nginx)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”
â”‚                   Application Layer                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”¤
â”‚  LINE Bot Service   â”‚  Main API Service   â”‚  Micro Services  â”‚
â”‚  (Python Flask)     â”‚  (FastAPI)          â”‚  (Docker)        â”‚
â”‚                     â”‚                     â”‚                  â”‚
â”‚  â€¢ Webhook Handler  â”‚  â€¢ Trip Management  â”‚  â€¢ OCR Service   â”‚
â”‚  â€¢ Message Router   â”‚  â€¢ Member Managementâ”‚  â€¢ AI Service    â”‚
â”‚  â€¢ Template Engine  â”‚  â€¢ Expense Service  â”‚  â€¢ Report Serviceâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”
â”‚                         Data Layer                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”¤
â”‚  PostgreSQL        â”‚  Redis Cache     â”‚  File Storage        â”‚
â”‚  (Main Datadase)   â”‚  (Session/Cache) â”‚  (Images/Documents)  â”‚
â”‚                    â”‚                  â”‚                      â”‚
â”‚  â€¢ Users           â”‚  â€¢ User Sessions â”‚  â€¢ Receipt Images    â”‚
â”‚  â€¢ Trips           â”‚  â€¢ API Cache     â”‚  â€¢ Profile Photos    â”‚
â”‚  â€¢ Expenses        â”‚  â€¢ Rate Limiting â”‚  â€¢ Export Files      â”‚
â”‚  â€¢ Settlements     â”‚                  â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”˜
```

## äºŒã€æœ¬æ©Ÿé–‹ç™¼ç’°å¢ƒè¨­å®š

### é–‹ç™¼ç’°å¢ƒéœ€æ±‚
- **macOS**: 13.0+ (Monterey æˆ–æ›´æ–°ç‰ˆæœ¬)
- **Docker Desktop**: 4.15+
- **Python**: 3.9+
- **Node.js**: 18+
- **Git**: 2.30+

### æœ¬æ©Ÿç’°å¢ƒæ¶æ§‹
```yaml
# docker-compose.dev.yml
version: '3.8'

services:
  # è³‡æ–™åº«æœå‹™
  postgres:
    image: postgres:15
    container_name: beanthere_postgres
    environment:
      POSTGRES_DB: beanthere_dev
      POSTGRES_USER: beanthere
      POSTGRES_PASSWORD: dev_password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql

  # Redis å¿«å–æœå‹™
  redis:
    image: redis:7-alpine
    container_name: beanthere_redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  # ä¸»è¦ API æœå‹™
  api:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    container_name: beanthere_api
    environment:
      - DATABASE_URL=postgresql://beanthere:dev_password@postgres:5432/beanthere_dev
      - REDIS_URL=redis://redis:6379
      - LINE_CHANNEL_SECRET=${LINE_CHANNEL_SECRET}
      - LINE_CHANNEL_ACCESS_TOKEN=${LINE_CHANNEL_ACCESS_TOKEN}
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app
      - ./uploads:/app/uploads
    depends_on:
      - postgres
      - redis
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  # LINE Bot æœå‹™
  linebot:
    build:
      context: ./frontend/line-bot
      dockerfile: Dockerfile.dev
    container_name: beanthere_linebot
    environment:
      - API_BASE_URL=http://api:8000
      - LINE_CHANNEL_SECRET=${LINE_CHANNEL_SECRET}
      - LINE_CHANNEL_ACCESS_TOKEN=${LINE_CHANNEL_ACCESS_TOKEN}
    ports:
      - "5000:5000"
    volumes:
      - ./frontend/line-bot:/app
    depends_on:
      - api
    command: python app.py

  # OCR æœå‹™
  ocr-service:
    build:
      context: ./services/ocr-service
      dockerfile: Dockerfile.dev
    container_name: beanthere_ocr
    environment:
      - GOOGLE_APPLICATION_CREDENTIALS=/app/credentials/gcp-key.json
    ports:
      - "8001:8000"
    volumes:
      - ./services/ocr-service:/app
      - ./credentials:/app/credentials
    command: uvicorn app:app --host 0.0.0.0 --port 8000 --reload

  # Web App (é–‹ç™¼ä¼ºæœå™¨)
  webapp:
    build:
      context: ./frontend/web-app
      dockerfile: Dockerfile.dev
    container_name: beanthere_webapp
    environment:
      - VUE_APP_API_BASE_URL=http://localhost:8000
      - VUE_APP_LIFF_ID=${LIFF_ID}
    ports:
      - "3000:3000"
    volumes:
      - ./frontend/web-app:/app
      - /app/node_modules
    command: npm run serve

  # Nginx (æœ¬æ©Ÿåå‘ä»£ç†)
  nginx:
    image: nginx:alpine
    container_name: beanthere_nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./deployment/nginx/dev.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - api
      - linebot
      - webapp

volumes:
  postgres_data:
  redis_data:
```

### æœ¬æ©Ÿé–‹ç™¼å•Ÿå‹•è…³æœ¬
```bash
#!/bin/bash
# scripts/dev-setup.sh

echo "ğŸš€ BeanThere é–‹ç™¼ç’°å¢ƒå•Ÿå‹•ä¸­..."

# æª¢æŸ¥ Docker æ˜¯å¦é‹è¡Œ
if ! docker info > /dev/null 2>&1; then
    echo "âŒ Docker æœªå•Ÿå‹•ï¼Œè«‹å…ˆå•Ÿå‹• Docker Desktop"
    exit 1
fi

# å»ºç«‹å¿…è¦ç›®éŒ„
mkdir -p uploads credentials ssl logs

# è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
if [ ! -f .env ]; then
    cp .env.example .env
    echo "âš ï¸  è«‹è¨­å®š .env æª”æ¡ˆä¸­çš„ç’°å¢ƒè®Šæ•¸"
fi

# å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
docker-compose -f docker-compose.dev.yml up -d

echo "â³ ç­‰å¾…æœå‹™å•Ÿå‹•..."
sleep 10

# æª¢æŸ¥æœå‹™ç‹€æ…‹
echo "ğŸ” æª¢æŸ¥æœå‹™ç‹€æ…‹..."
docker-compose -f docker-compose.dev.yml ps

# åŸ·è¡Œè³‡æ–™åº«é·ç§»
echo "ğŸ—„ï¸ åŸ·è¡Œè³‡æ–™åº«é·ç§»..."
docker-compose -f docker-compose.dev.yml exec api python -m alembic upgrade head

echo "âœ… é–‹ç™¼ç’°å¢ƒå•Ÿå‹•å®Œæˆ!"
echo "ğŸ“± LINE Bot Webhook: http://localhost:5000/webhook"
echo "ğŸŒ Web App: http://localhost:3000"
echo "ğŸ”§ API æ–‡ä»¶: http://localhost:8000/docs"
```

## ä¸‰ã€é›²ç«¯éƒ¨ç½²æ¶æ§‹

### AWS é›²ç«¯æ¶æ§‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AWS Cloud                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Route 53 (DNS) â†’ CloudFront (CDN) â†’ ALB (Load Balancer)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ECS Cluster                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ECS Service (Auto Scaling)                                 â”‚
â”‚  â”œâ”€â”€ API Service (FastAPI)                                  â”‚
â”‚  â”œâ”€â”€ LINE Bot Service (Flask)                               â”‚
â”‚  â”œâ”€â”€ OCR Service (Python)                                   â”‚
â”‚  â””â”€â”€ Web App (Nginx + Vue.js)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Service                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RDS PostgreSQL  â”‚  ElastiCache Redis  â”‚  S3 Bucket         â”‚
â”‚  (Multi-AZ)      â”‚  (Cluster Mode)     â”‚  (File Storage)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éƒ¨ç½²é…ç½®æª”æ¡ˆ
```yaml
# deployment/docker-compose.prod.yml
version: '3.8'

services:
  api:
    image: beanthere/api:${VERSION}
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - LINE_CHANNEL_SECRET=${LINE_CHANNEL_SECRET}
      - LINE_CHANNEL_ACCESS_TOKEN=${LINE_CHANNEL_ACCESS_TOKEN}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - S3_BUCKET=${S3_BUCKET}
    deploy:
      replicas: 2
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  linebot:
    image: beanthere/linebot:${VERSION}
    environment:
      - API_BASE_URL=${API_BASE_URL}
      - LINE_CHANNEL_SECRET=${LINE_CHANNEL_SECRET}
      - LINE_CHANNEL_ACCESS_TOKEN=${LINE_CHANNEL_ACCESS_TOKEN}
    deploy:
      replicas: 2
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 128M

  webapp:
    image: beanthere/webapp:${VERSION}
    environment:
      - VUE_APP_API_BASE_URL=${API_BASE_URL}
      - VUE_APP_LIFF_ID=${LIFF_ID}
    deploy:
      replicas: 2

  nginx:
    image: beanthere/nginx:${VERSION}
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - api
      - linebot
      - webapp
```

### Terraform åŸºç¤è¨­æ–½ç¨‹å¼ç¢¼
```hcl
# deployment/terraform/main.tf
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

provider "aws" {
  region = var.aws_region
}

# VPC è¨­å®š
resource "aws_vpc" "main" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true

  tags = {
    Name = "beanthere-vpc"
  }
}

# ECS Cluster
resource "aws_ecs_cluster" "main" {
  name = "beanthere-cluster"

  setting {
    name  = "containerInsights"
    value = "enabled"
  }
}

# RDS PostgreSQL
resource "aws_db_instance" "main" {
  identifier = "beanthere-db"
  
  engine         = "postgres"
  engine_version = "15.4"
  instance_class = "db.t3.micro"
  
  allocated_storage     = 20
  max_allocated_storage = 100
  storage_encrypted     = true
  
  db_name  = "beanthere"
  username = var.db_username
  password = var.db_password
  
  vpc_security_group_ids = [aws_security_group.rds.id]
  db_subnet_group_name   = aws_db_subnet_group.main.name
  
  backup_retention_period = 7
  backup_window          = "03:00-04:00"
  maintenance_window     = "sun:04:00-sun:05:00"
  
  skip_final_snapshot = true
  deletion_protection = false
  
  tags = {
    Name = "beanthere-database"
  }
}

# ElastiCache Redis
resource "aws_elasticache_subnet_group" "main" {
  name       = "beanthere-cache-subnet"
  subnet_ids = aws_subnet.private[*].id
}

resource "aws_elasticache_cluster" "main" {
  cluster_id           = "beanthere-cache"
  engine               = "redis"
  node_type            = "cache.t3.micro"
  num_cache_nodes      = 1
  parameter_group_name = "default.redis7"
  port                 = 6379
  subnet_group_name    = aws_elasticache_subnet_group.main.name
  security_group_ids   = [aws_security_group.redis.id]
}

# S3 Bucket
resource "aws_s3_bucket" "uploads" {
  bucket = "beanthere-uploads-${random_string.bucket_suffix.result}"
}

resource "random_string" "bucket_suffix" {
  length  = 8
  special = false
  upper   = false
}
```

## å››ã€ç›£æ§èˆ‡æ—¥èªŒ

### ç›£æ§æ¶æ§‹
```yaml
# monitoring/docker-compose.monitoring.yml
version: '3.8'

services:
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'

  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    ports:
      - "3001:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana_data:/var/lib/grafana
      - ./grafana/dashboards:/etc/grafana/provisioning/dashboards
      - ./grafana/datasources:/etc/grafana/provisioning/datasources

  loki:
    image: grafana/loki:latest
    container_name: loki
    ports:
      - "3100:3100"
    volumes:
      - ./loki-config.yml:/etc/loki/local-config.yaml
      - loki_data:/loki

  promtail:
    image: grafana/promtail:latest
    container_name: promtail
    volumes:
      - /var/log:/var/log:ro
      - ./promtail-config.yml:/etc/promtail/config.yml

volumes:
  prometheus_data:
  grafana_data:
  loki_data:
```

## äº”ã€CI/CD Pipeline

### GitHub Actions å·¥ä½œæµç¨‹
```yaml
# .github/workflows/deploy.yml
name: Deploy BeanThere

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          
      - name: Install dependencies
        run: |
          pip install -r backend/requirements.txt
          pip install pytest pytest-cov
          
      - name: Run tests
        run: |
          cd backend
          pytest tests/ --cov=app --cov-report=xml
          
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3

  build-and-push:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ap-northeast-1
          
      - name: Login to Amazon ECR
        id: login-ecr
        uses: aws-actions/amazon-ecr-login@v1
        
      - name: Build and push Docker images
        env:
          ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
          ECR_REPOSITORY: beanthere
          IMAGE_TAG: ${{ github.sha }}
        run: |
          # Build API
          docker build -t $ECR_REGISTRY/$ECR_REPOSITORY-api:$IMAGE_TAG ./backend
          docker push $ECR_REGISTRY/$ECR_REPOSITORY-api:$IMAGE_TAG
          
          # Build LINE Bot
          docker build -t $ECR_REGISTRY/$ECR_REPOSITORY-linebot:$IMAGE_TAG ./frontend/line-bot
          docker push $ECR_REGISTRY/$ECR_REPOSITORY-linebot:$IMAGE_TAG
          
          # Build Web App
          docker build -t $ECR_REGISTRY/$ECR_REPOSITORY-webapp:$IMAGE_TAG ./frontend/web-app
          docker push $ECR_REGISTRY/$ECR_REPOSITORY-webapp:$IMAGE_TAG

  deploy:
    needs: build-and-push
    runs-on: ubuntu-latest
    
    steps:
      - name: Deploy to ECS
        run: |
          aws ecs update-service --cluster beanthere-cluster --service beanthere-api --force-new-deployment
          aws ecs update-service --cluster beanthere-cluster --service beanthere-linebot --force-new-deployment
          aws ecs update-service --cluster beanthere-cluster --service beanthere-webapp --force-new-deployment
```

## å…­ã€å®‰å…¨æ€§é…ç½®

### å®‰å…¨æ€§æª¢æŸ¥æ¸…å–®
- [ ] **SSL/TLS æ†‘è­‰**: Let's Encrypt æˆ– AWS Certificate Manager
- [ ] **API èªè­‰**: JWT Token é©—è­‰
- [ ] **è³‡æ–™åº«åŠ å¯†**: é€£ç·šèˆ‡å„²å­˜åŠ å¯†
- [ ] **ç’°å¢ƒè®Šæ•¸**: AWS Parameter Store æˆ– Secrets Manager
- [ ] **ç¶²è·¯å®‰å…¨**: VPC, Security Groups, NACL
- [ ] **æª”æ¡ˆä¸Šå‚³**: é¡å‹é™åˆ¶ã€å¤§å°é™åˆ¶ã€ç—…æ¯’æƒæ
- [ ] **API é™æµ**: Redis + sliding window
- [ ] **æ—¥èªŒè¨˜éŒ„**: ä¸è¨˜éŒ„æ•æ„Ÿè³‡è¨Š
- [ ] **GDPR åˆè¦**: è³‡æ–™ä¿è­·èˆ‡åˆªé™¤æ©Ÿåˆ¶

### ç’°å¢ƒè®Šæ•¸ç®¡ç†
```bash
# .env.example
# æ‡‰ç”¨ç¨‹å¼è¨­å®š
APP_NAME=BeanThere
APP_ENV=development
DEBUG=true

# è³‡æ–™åº«è¨­å®š
DATABASE_URL=postgresql://beanthere:password@localhost:5432/beanthere_dev
REDIS_URL=redis://localhost:6379

# LINE Bot è¨­å®š
LINE_CHANNEL_SECRET=your_channel_secret
LINE_CHANNEL_ACCESS_TOKEN=your_access_token
LIFF_ID=your_liff_id

# ç¬¬ä¸‰æ–¹æœå‹™
GOOGLE_APPLICATION_CREDENTIALS=path/to/gcp-key.json
AWS_ACCESS_KEY_ID=your_aws_key
AWS_SECRET_ACCESS_KEY=your_aws_secret
S3_BUCKET=beanthere-uploads

# å®‰å…¨æ€§è¨­å®š
JWT_SECRET=your_jwt_secret
ENCRYPTION_KEY=your_encryption_key
```

## ä¸ƒã€æˆæœ¬ä¼°ç®—

### AWS æœˆè²»ç”¨ä¼°ç®— (MVP éšæ®µ)
- **ECS Fargate**: $30-50/æœˆ (2 vCPU, 4GB RAM)
- **RDS PostgreSQL**: $15-25/æœˆ (db.t3.micro)
- **ElastiCache Redis**: $10-15/æœˆ (cache.t3.micro)
- **S3 + CloudFront**: $5-10/æœˆ
- **ALB**: $20/æœˆ
- **Route 53**: $0.5/æœˆ
- **ç¸½è¨ˆ**: ç´„ $80-120/æœˆ

### æœ¬æ©Ÿé–‹ç™¼æˆæœ¬
- **macOS é–‹ç™¼æ©Ÿ**: ç¾æœ‰è¨­å‚™
- **Docker Desktop**: å…è²»
- **é–‹ç™¼å·¥å…·**: å…è²» (VS Code, Git ç­‰)
- **LINE Bot é–‹ç™¼**: å…è²»é¡åº¦
- **ç¸½è¨ˆ**: $0/æœˆ

é€™å€‹æ¶æ§‹è¨­è¨ˆæä¾›äº†å®Œæ•´çš„æœ¬æ©Ÿé–‹ç™¼åˆ°é›²ç«¯éƒ¨ç½²çš„è§£æ±ºæ–¹æ¡ˆï¼Œå…·æœ‰è‰¯å¥½çš„å¯æ“´å±•æ€§å’Œç¶­è­·æ€§ã€‚